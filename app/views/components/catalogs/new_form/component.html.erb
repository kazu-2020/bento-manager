<%= form_with url: helpers.catalogs_path, method: :post, data: { turbo: true } do |form| %>
  <%# エラー表示 %>
  <% if errors&.any? %>
    <div class="alert alert-error mb-4" role="alert">
      <%= component "icons/error", extra_class: "shrink-0" %>
      <ul class="list-disc list-inside">
        <% errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if category_selected? %>
    <%# カテゴリ選択済み: 選択されたカテゴリを表示 + フォームフィールド %>
    <div class="mb-6">
      <%= component "catalogs/category_selector", selected: selected_category %>
    </div>

    <%# 隠しフィールド: カテゴリ %>
    <input type="hidden" name="catalog[category]" value="<%= selected_category %>">

    <%# フォームフィールド %>
    <div id="<%= form_fields_frame_id %>">
      <% if bento_selected? %>
        <%= component "catalogs/bento_fields", errors: errors %>
      <% elsif side_menu_selected? %>
        <%= component "catalogs/side_menu_fields", errors: errors %>
      <% end %>
    </div>

    <%# アクションボタン %>
    <div class="modal-action mt-6">
      <form method="dialog" class="inline">
        <button class="btn btn-ghost"><%= t("helpers.link.cancel") %></button>
      </form>
      <%= form.submit t("catalogs.new.submit"), class: "btn btn-neutral" %>
    </div>
  <% else %>
    <%# カテゴリ未選択: カテゴリ選択カードを表示 %>
    <p class="text-base-content/70 mb-4"><%= t("catalogs.new.select_category") %></p>

    <%= component "catalogs/category_selector", selected: nil %>

    <%# 隠しフィールド（Stimulus で更新） %>
    <div id="catalog_category_hidden">
      <input type="hidden" name="catalog[category]" value="" data-category-selector-target="hiddenInput">
    </div>

    <%# フォームフィールド用 turbo-frame（空状態） %>
    <div id="<%= form_fields_frame_id %>" class="mt-6"></div>

    <%# キャンセルボタンのみ（カテゴリ未選択時） %>
    <div class="modal-action mt-6" id="catalog_modal_actions">
      <form method="dialog" class="inline">
        <button class="btn btn-ghost"><%= t("helpers.link.cancel") %></button>
      </form>
    </div>
  <% end %>
<% end %>
