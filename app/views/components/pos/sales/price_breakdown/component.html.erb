<div id="price-breakdown">
  <% if has_items_in_cart? %>
    <details class="group">
      <summary class="flex justify-between items-center cursor-pointer [&::-webkit-details-marker]:hidden list-none">
        <span class="flex items-center gap-2">
          <span class="text-lg font-bold"><%= t(".total") %></span>
          <span class="text-xs text-base-content/50"><%= t(".item_count", count: item_count) %></span>
          <svg class="w-4 h-4 text-base-content/40 transition-transform group-open:rotate-180"
               fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </span>
        <span class="text-xl font-bold text-primary"><%= format_price(final_total) %></span>
      </summary>

      <div class="mt-2 max-h-36 overflow-y-auto">
        <%# 明細行 %>
        <div class="space-y-1 text-sm">
          <% items_with_prices.each do |item| %>
            <div class="flex justify-between">
              <span>
                <%= item[:catalog].name %>
                <% if bundle_price?(item) %>
                  <span class="badge badge-xs badge-accent"><%= t(".bundle") %></span>
                <% end %>
                × <%= item[:quantity] %>
              </span>
              <span><%= format_price(item[:unit_price] * item[:quantity]) %></span>
            </div>
          <% end %>
        </div>

        <%# 小計 %>
        <div class="flex justify-between mt-2 pt-1 border-t border-base-300 text-sm">
          <span><%= t(".subtotal") %></span>
          <span><%= format_price(subtotal) %></span>
        </div>

        <%# 割引行 %>
        <% if has_discounts? %>
          <% discount_details.select { |d| d[:applicable] }.each do |detail| %>
            <div class="flex justify-between text-sm text-accent">
              <span><%= detail[:discount_name] %></span>
              <span>-<%= format_price(detail[:discount_amount]) %></span>
            </div>
          <% end %>
        <% end %>
      </div>
    </details>
  <% else %>
    <p class="text-center text-base-content/50 text-sm py-1"><%= t(".empty_cart") %></p>
  <% end %>
</div>
