<div class="card bg-base-100 border border-base-300 <%= 'ring-2 ring-error' if selected? %>">
  <div class="card-body p-4">
    <%# 商品情報ヘッダー %>
    <div class="flex items-start justify-between gap-2 mb-3">
      <div class="min-w-0 flex-1">
        <div class="flex items-center gap-2 mb-1">
          <span class="badge <%= category_badge_class %> badge-sm shrink-0"><%= category_label %></span>
          <span class="font-bold truncate"><%= catalog_name %></span>
        </div>
        <%# 元の購入内訳（参考情報） %>
        <div class="text-xs text-base-content/60 mt-1">
          <% items.each_with_index do |item, index| %>
            <% if item.bundle_price? %>
              <span class="badge badge-xs badge-accent"><%= t(".bundle") %></span>
            <% end %>
            <%= formatted_unit_price(item) %> x <%= item.quantity %><%= "、" unless index == items.size - 1 %>
          <% end %>
        </div>
      </div>
      <div class="text-right shrink-0">
        <div class="font-bold text-lg"><%= formatted_total_line_total %></div>
        <div class="text-xs text-base-content/60"><%= t(".total_quantity", count: total_quantity) %></div>
      </div>
    </div>

    <%# 返品数入力（グループ単位で1つ） %>
    <div class="pt-3 border-t border-base-200">
      <div class="flex items-center justify-end gap-2" data-controller="quantity-stepper">
        <span class="text-sm text-base-content/70 mr-2"><%= t(".refund") %></span>
        <button type="button"
                class="btn btn-circle btn-outline btn-sm"
                aria-label="<%= t('.decrement') %>"
                data-action="quantity-stepper#decrement">
          <%= component "icons/minus", extra_class: "h-4 w-4" %>
        </button>

        <%= number_field_tag quantity_field_name, refund_quantity,
                             id: quantity_field_id,
                             min: 0,
                             max: total_quantity,
                             step: 1,
                             class: "input input-bordered input-sm w-14 text-center font-bold",
                             data: {
                               quantity_stepper_target: "input",
                               action: "change->refund-cart#toggle"
                             } %>

        <button type="button"
                class="btn btn-circle btn-outline btn-sm"
                aria-label="<%= t('.increment') %>"
                data-action="quantity-stepper#increment">
          <%= component "icons/plus", extra_class: "h-4 w-4" %>
        </button>

        <span class="text-sm"><%= t(".unit") %></span>
      </div>
    </div>
  </div>
</div>
