<div class="card bg-base-100 border border-base-300 <%= 'opacity-60' if voided? %>">
  <div class="card-body p-0">
    <details class="group">
      <%# サマリー（常に表示） %>
      <summary class="flex items-center justify-between p-4 cursor-pointer [&::-webkit-details-marker]:hidden list-none">
        <div class="flex items-center gap-3">
          <%# 時刻 %>
          <span class="text-lg font-mono font-bold"><%= sale_time %></span>

          <%# 顧客区分バッジ %>
          <span class="badge <%= customer_type_badge_class %> badge-sm"><%= customer_type_label %></span>

          <% if voided? %>
            <span class="badge badge-error badge-sm"><%= t("enums.sale.status.voided") %></span>
          <% end %>
        </div>

        <div class="flex items-center gap-3">
          <%# 金額 %>
          <span class="text-xl font-bold <%= voided? ? 'line-through text-base-content/50' : 'text-success' %>"><%= formatted_amount %></span>

          <%# 展開アイコン %>
          <svg class="w-5 h-5 text-base-content/40 transition-transform group-open:rotate-180"
               fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </div>
      </summary>

      <%# 詳細（展開時） %>
      <div class="px-4 pb-4 border-t border-base-200">
        <%# 商品明細 %>
        <div class="mt-3 space-y-2">
          <% items.each do |item| %>
            <div class="flex justify-between text-sm">
              <span>
                <%= item.catalog.name %>
                <span class="text-base-content/60">x<%= item.quantity %></span>
              </span>
              <span><%= helpers.number_to_currency(item.line_total) %></span>
            </div>
          <% end %>

          <% if has_discounts? %>
            <div class="flex justify-between text-sm text-error border-t border-base-200 pt-2">
              <span><%= t("activerecord.models.discount") %></span>
              <span><%= formatted_discounts_summary %></span>
            </div>
          <% end %>
        </div>

        <%# 返品ボタン %>
        <% unless voided? %>
          <div class="mt-4">
            <%= link_to refund_url, class: "btn btn-error btn-outline btn-sm w-full" do %>
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
              </svg>
              <%= t("activerecord.models.refund") %>
            <% end %>
          </div>
        <% end %>
      </div>
    </details>
  </div>
</div>
