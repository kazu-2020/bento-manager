<%= helpers.turbo_frame_tag frame_id do %>
  <section class="<%= card_classes %> mb-6 animate-fade-in" aria-labelledby="discount-coupon-form-heading">
    <div class="card-body">
      <%= form_with model: discount, url: discount_path, method: :patch, data: { turbo_frame: frame_id } do |f| %>
        <%= f.fields_for :discountable, coupon do |coupon_form| %>
          <%# ヘッダー: タイトル + アクションボタン %>
          <div class="flex items-center justify-between mb-4">
            <h2 id="discount-coupon-form-heading" class="card-title text-lg flex items-center gap-2">
              <%= component "icons/ticket", size: :sm, extra_class: "text-primary" %>
              <%= t(".title") %>
            </h2>
            <div class="flex items-center gap-2">
              <%= link_to t("helpers.link.cancel"),
                  cancel_path,
                  class: "btn btn-ghost btn-sm",
                  data: { turbo_frame: frame_id } %>
              <%= f.submit t(".update"),
                  class: "btn btn-neutral btn-sm" %>
            </div>
          </div>

          <%= coupon_form.hidden_field :id %>

          <%# 説明 %>
          <div class="form-control w-full mb-4">
            <%= coupon_form.label :description, class: "label" do %>
              <span class="label-text font-medium">
                <%= Coupon.human_attribute_name(:description) %>
                <span class="text-error">*</span>
              </span>
            <% end %>
            <%= coupon_form.text_area :description,
                rows: 3,
                required: true,
                class: "textarea textarea-bordered w-full #{coupon.errors[:description].any? ? 'textarea-error' : ''}",
                placeholder: t(".placeholder.description") %>
            <% coupon.errors.where(:description).each do |error| %>
              <p class="text-sm text-error mt-1"><%= error.full_message %></p>
            <% end %>
          </div>

          <%# 1枚あたりの割引額 と 最大適用枚数 %>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="form-control w-full">
              <%= coupon_form.label :amount_per_unit, class: "label" do %>
                <span class="label-text font-medium">
                  <%= Coupon.human_attribute_name(:amount_per_unit) %>
                  <span class="text-error">*</span>
                </span>
              <% end %>
              <div class="join w-full">
                <span class="join-item btn btn-disabled">¥</span>
                <%= coupon_form.number_field :amount_per_unit,
                    required: true,
                    min: 1,
                    class: "join-item input input-bordered w-full #{coupon.errors[:amount_per_unit].any? ? 'input-error' : ''}",
                    placeholder: t(".placeholder.amount_per_unit") %>
              </div>
              <% coupon.errors.where(:amount_per_unit).each do |error| %>
                <p class="text-sm text-error mt-1"><%= error.full_message %></p>
              <% end %>
            </div>

            <div class="form-control w-full">
              <%= coupon_form.label :max_per_bento_quantity, class: "label" do %>
                <span class="label-text font-medium">
                <%= Coupon.human_attribute_name(:max_per_bento_quantity) %>
                <span class="text-error">*</span>
              </span>
              <% end %>
              <%= coupon_form.number_field :max_per_bento_quantity,
                  required: true,
                  min: 0,
                  class: "input input-bordered w-full #{coupon.errors[:max_per_bento_quantity].any? ? 'input-error' : ''}",
                  placeholder: t(".placeholder.max_per_bento_quantity") %>
              <p class="text-xs text-base-content/60 mt-1"><%= t(".hint.max_per_bento_quantity") %></p>
              <% coupon.errors.where(:max_per_bento_quantity).each do |error| %>
                <p class="text-sm text-error mt-1"><%= error.full_message %></p>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </section>
<% end %>
